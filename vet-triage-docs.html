<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MyVet Direction - Project Documentation</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --primary-color: #2c3e50;
            --secondary-color: #3498db;
            --accent-color: #e74c3c;
            --success-color: #27ae60;
            --warning-color: #f39c12;
            --bg-color: #f8f9fa;
            --text-color: #2c3e50;
            --border-color: #dee2e6;
            --shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            line-height: 1.6;
            color: var(--text-color);
            background: var(--bg-color);
        }

        /* Accessibility skip link */
        .sr-only {
            position: absolute;
            width: 1px;
            height: 1px;
            padding: 0;
            margin: -1px;
            overflow: hidden;
            clip: rect(0,0,0,0);
            white-space: nowrap;
            border: 0;
        }

        .sr-only-focusable:focus {
            position: absolute;
            top: 0;
            left: 0;
            z-index: 1000;
            padding: 1rem;
            background: var(--primary-color);
            color: white;
            text-decoration: none;
            width: auto;
            height: auto;
            clip: auto;
            white-space: normal;
        }

        .header {
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            color: white;
            padding: 2rem;
            text-align: center;
            box-shadow: var(--shadow);
        }

        .header h1 {
            font-size: 2.5rem;
            margin-bottom: 0.5rem;
            font-weight: 300;
        }

        .header p {
            opacity: 0.9;
            font-size: 1.1rem;
        }

        .header .phase-note {
            font-size: 0.95rem;
            margin-top: 0.5rem;
            opacity: 0.85;
            font-style: italic;
        }

        .nav-tabs {
            background: white;
            padding: 0;
            display: flex;
            border-bottom: 2px solid var(--border-color);
            box-shadow: 0 2px 5px rgba(0,0,0,0.05);
            position: sticky;
            top: 0;
            z-index: 100;
        }

        .nav-tab {
            flex: 1;
            padding: 1.2rem;
            background: none;
            border: none;
            cursor: pointer;
            font-size: 1rem;
            font-weight: 500;
            color: var(--text-color);
            transition: all 0.3s ease;
            position: relative;
        }

        .nav-tab:hover {
            background: var(--bg-color);
        }

        .nav-tab.active {
            color: var(--secondary-color);
        }

        .nav-tab.active::after {
            content: '';
            position: absolute;
            bottom: -2px;
            left: 0;
            right: 0;
            height: 3px;
            background: var(--secondary-color);
        }

        /* Strong keyboard focus */
        .nav-tab:focus-visible {
            outline: 3px solid var(--secondary-color);
            outline-offset: 2px;
            border-radius: 4px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 2rem;
        }

        .document {
            display: none;
            animation: fadeIn 0.3s ease;
            scroll-margin-top: 72px;
        }

        .document.active {
            display: block;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* Respect reduced motion */
        @media (prefers-reduced-motion: reduce) {
            * { 
                animation-duration: 0.001ms !important; 
                animation-iteration-count: 1 !important; 
                transition-duration: 0.001ms !important; 
            }
        }

        .doc-header {
            background: white;
            padding: 2rem;
            border-radius: 8px;
            margin-bottom: 2rem;
            box-shadow: var(--shadow);
        }

        .doc-meta {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1rem;
            margin-top: 1rem;
            padding-top: 1rem;
            border-top: 1px solid var(--border-color);
        }

        .meta-item {
            display: flex;
            flex-direction: column;
        }

        .meta-label {
            font-size: 0.875rem;
            color: #6c757d;
            margin-bottom: 0.25rem;
        }

        .meta-value {
            font-weight: 500;
            color: var(--text-color);
        }

        .section {
            background: white;
            padding: 2rem;
            border-radius: 8px;
            margin-bottom: 1.5rem;
            box-shadow: var(--shadow);
        }

        .section h2 {
            color: var(--primary-color);
            margin-bottom: 1.5rem;
            padding-bottom: 0.5rem;
            border-bottom: 2px solid var(--border-color);
            font-size: 1.75rem;
        }

        .section h3 {
            color: var(--primary-color);
            margin-top: 1.5rem;
            margin-bottom: 1rem;
            font-size: 1.25rem;
        }

        .section h4 {
            color: var(--text-color);
            margin-top: 1rem;
            margin-bottom: 0.5rem;
            font-weight: 600;
        }

        ul, ol {
            margin-left: 2rem;
            margin-bottom: 1rem;
        }

        li {
            margin-bottom: 0.5rem;
            line-height: 1.8;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            margin: 1rem 0;
        }

        th, td {
            padding: 0.75rem;
            text-align: left;
            border: 1px solid var(--border-color);
        }

        th {
            background: var(--bg-color);
            font-weight: 600;
            color: var(--primary-color);
        }

        tr:hover {
            background: #f8f9fa;
        }

        .code-block {
            background: #2c3e50;
            color: #ecf0f1;
            padding: 1rem;
            border-radius: 4px;
            overflow-x: auto;
            margin: 1rem 0;
            font-family: 'Courier New', monospace;
            font-size: 0.9rem;
            line-height: 1.4;
            white-space: pre-wrap;
            word-break: break-word;
        }

        .signature-block {
            margin-top: 3rem;
            padding: 2rem;
            background: var(--bg-color);
            border-radius: 8px;
            border: 2px dashed var(--border-color);
        }

        .signature-line {
            display: grid;
            grid-template-columns: 2fr 1fr 1fr;
            gap: 2rem;
            margin-bottom: 1rem;
            align-items: end;
        }

        .signature-field {
            border-bottom: 2px solid var(--text-color);
            padding-bottom: 0.5rem;
            min-height: 2rem;
        }

        .highlight {
            background: #fff3cd;
            padding: 1rem;
            border-left: 4px solid #ffc107;
            margin: 1rem 0;
            border-radius: 4px;
        }

        .safety-box {
            background: #ffebee;
            border: 2px solid #ef5350;
            padding: 1.5rem;
            border-radius: 8px;
            margin: 1.5rem 0;
        }

        .safety-box h4 {
            color: #c62828;
            margin-top: 0;
        }

        .tech-detail {
            background: #e8f5e9;
            padding: 1rem;
            border-left: 4px solid var(--success-color);
            margin: 1rem 0;
            border-radius: 4px;
            font-family: 'Courier New', monospace;
            font-size: 0.9rem;
        }

        .implementation-box {
            background: #f0f4ff;
            border: 2px solid #3498db;
            padding: 1.5rem;
            border-radius: 8px;
            margin: 1rem 0;
        }

        .implementation-box h4 {
            color: #3498db;
            margin-top: 0;
        }

        .milestone-table {
            margin-top: 1rem;
        }

        /* Roadmap specific styles */
        .day-card {
            background: white;
            border-left: 4px solid var(--secondary-color);
            padding: 1.5rem;
            margin-bottom: 1rem;
            border-radius: 4px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.05);
        }

        .day-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
        }

        .day-title {
            font-size: 1.2rem;
            font-weight: 600;
            color: var(--primary-color);
        }

        .day-badge {
            background: var(--secondary-color);
            color: white;
            padding: 0.25rem 0.75rem;
            border-radius: 20px;
            font-size: 0.875rem;
        }

        .week-separator {
            text-align: center;
            margin: 2rem 0;
            position: relative;
        }

        .week-separator::before {
            content: '';
            position: absolute;
            left: 0;
            right: 0;
            top: 50%;
            height: 2px;
            background: var(--border-color);
        }

        .week-label {
            background: var(--bg-color);
            padding: 0.5rem 1rem;
            display: inline-block;
            position: relative;
            font-weight: 600;
            color: var(--primary-color);
            font-size: 1.1rem;
        }

        .milestone-marker {
            background: var(--success-color);
            color: white;
            padding: 0.75rem;
            border-radius: 4px;
            margin: 1rem 0;
            font-weight: 500;
        }

        .deliverables-list {
            background: var(--bg-color);
            padding: 1rem;
            border-radius: 4px;
            margin-top: 0.5rem;
        }

        .acceptance-criteria {
            background: linear-gradient(135deg, #e8f5e9, #c8e6c9);
            border-left: 4px solid var(--success-color);
            padding: 1rem;
            border-radius: 4px;
            margin: 1rem 0;
        }

        .demo-script {
            background: #f3e5f5;
            border-left: 4px solid #9c27b0;
            padding: 1rem;
            border-radius: 4px;
            margin: 1rem 0;
        }

        .how-to-box {
            background: #fff8e1;
            border: 2px solid #ffc107;
            padding: 1.5rem;
            border-radius: 8px;
            margin: 1.5rem 0;
        }

        .how-to-box h4 {
            color: #f57c00;
            margin-top: 0;
            font-size: 1.1rem;
        }

        .action-buttons {
            position: fixed;
            bottom: 2rem;
            right: 2rem;
            display: flex;
            gap: 1rem;
            flex-direction: column;
            align-items: flex-end;
        }

        .action-button {
            background: var(--secondary-color);
            color: white;
            border: none;
            padding: 1rem 1.5rem;
            border-radius: 50px;
            cursor: pointer;
            box-shadow: var(--shadow);
            font-size: 1rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            transition: transform 0.3s ease;
        }

        .action-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
        }

        .action-button.secondary {
            background: var(--success-color);
        }

        @media print {
            .nav-tabs, .action-buttons, .header .phase-note, .sr-only {
                display: none !important;
            }
            
            .header {
                background: none;
                color: var(--text-color);
                border-bottom: 2px solid var(--primary-color);
            }
            
            .document {
                display: block !important;
                page-break-after: always;
            }
            
            .section {
                box-shadow: none;
                border: 1px solid #ddd;
                page-break-inside: avoid;
            }
            
            .day-card {
                page-break-inside: avoid;
            }
            
            h2, h3 {
                page-break-after: avoid;
            }
        }

        @media (max-width: 768px) {
            .container {
                padding: 1rem;
            }
            
            .section {
                padding: 1rem;
            }
            
            .signature-line {
                grid-template-columns: 1fr;
            }
            
            .nav-tab {
                font-size: 0.9rem;
                padding: 1rem 0.5rem;
            }
            
            .action-buttons {
                bottom: 1rem;
                right: 1rem;
            }
        }
    </style>
</head>
<body>
    <a href="#sow" class="sr-only sr-only-focusable">Skip to content</a>
    
    <header class="header">
        <h1>MyVet Direction</h1>
        <p>Emergency-Ready Veterinary AI Triage - Complete Project Documentation</p>
        <p class="phase-note">Phase A = 2-week MVP (thin slice) inside a 6-week engagement that includes validation, polish, and handover</p>
    </header>

    <nav class="nav-tabs" role="tablist" aria-label="Documents">
        <button class="nav-tab active"
                role="tab" aria-selected="true"
                id="tab-sow" aria-controls="panel-sow"
                onclick="switchTab('sow', this)">Statement of Work</button>
        <button class="nav-tab"
                role="tab" aria-selected="false"
                id="tab-prd" aria-controls="panel-prd"
                onclick="switchTab('prd', this)">Product Requirements</button>
        <button class="nav-tab"
                role="tab" aria-selected="false"
                id="tab-roadmap" aria-controls="panel-roadmap"
                onclick="switchTab('roadmap', this)">14-Day Implementation</button>
    </nav>

    <main class="container">
        <!-- SOW Document -->
        <section id="sow" class="document active" role="tabpanel" aria-labelledby="tab-sow">
            <div class="doc-header">
                <h2>Statement of Work (SOW)</h2>
                <div class="doc-meta">
                    <div class="meta-item">
                        <span class="meta-label">Version</span>
                        <span class="meta-value">v1.0</span>
                    </div>
                    <div class="meta-item">
                        <span class="meta-label">Date</span>
                        <span class="meta-value">August 15, 2025</span>
                    </div>
                    <div class="meta-item">
                        <span class="meta-label">Duration</span>
                        <span class="meta-value">6 weeks @ ~20 hrs/week</span>
                    </div>
                    <div class="meta-item">
                        <span class="meta-label">Total Hours</span>
                        <span class="meta-value">~120 hours</span>
                    </div>
                </div>
            </div>

            <div class="section">
                <h2>1. Objective</h2>
                <p>Design and implement a hybrid AI triage MVP that combines:</p>
                <ul>
                    <li>NLP → Structured JSON extraction (LLM + Pydantic-validated output)</li>
                    <li>A deterministic, explainable rule engine (semantic-assisted)</li>
                </ul>
                <p>To identify Emergency, Urgent, Sick/Monitor priorities for small-animal (dog/cat) cases, produce a traceable audit, and meet explicit clinical safety gates for emergency detection.</p>
            </div>

            <div class="section">
                <h2>2. In-Scope Deliverables (Phase A)</h2>
                
                <h3>D1. Requirements & Compliance Pack</h3>
                <ul>
                    <li>Finalized PRD (this package) and acceptance criteria</li>
                    <li>Security, privacy, and data-handling plan (vet triage context; GDPR/CCPA-aware)</li>
                    <li>Third-party & open-source SBOM with license notes (including model/data licenses: LLM, embeddings, VetSNOMED/SNOMED CT, Merck excerpts, and any redistribution constraints)</li>
                </ul>

                <h3>D2. Ontology & Schema</h3>
                <ul>
                    <li>Vet symptom & qualifier schema (species, age bucket, reproductive status, symptom list + qualifiers)</li>
                    <li>Mapping script (Vet terms → internal schema), with synonym table</li>
                </ul>

                <h3>D3. Extractor (LLM) MVP</h3>
                <ul>
                    <li>Prompt-engineered extractor service returning strict Pydantic JSON</li>
                    <li>JSON repair/retry wrapper; unit tests; baseline metrics report on 100–200 labeled cases</li>
                </ul>

                <h3>D4. Rule Engine v0.1</h3>
                <ul>
                    <li>Deterministic rule graph for top emergency presentations (≈50–70 high-stakes rules from your case list)</li>
                    <li>Semantic similarity fallback (embeddings) to normalize colloquial input</li>
                    <li>Audit Trail JSON (which rules fired, why, and data used)</li>
                </ul>

                <h3>D5. API & Thin UI</h3>
                <ul>
                    <li>FastAPI endpoints: /transcribe (stub or Whisper POC), /extract, /triage</li>
                    <li>Minimal web widget (Svelte + Vite + Tailwind) to demo intake → triage → audit trace</li>
                </ul>

                <h3>D6. Safety Gating & KPI Report</h3>
                <ul>
                    <li>Safety gate for Emergency: human-in-the-loop trigger when confidence < threshold</li>
                    <li>Week-6 metrics report on hold-out set (Test set ≥ 650 cases: ≥ 500 non-ER, ≥ 150 ER):
                        <ul>
                            <li>Emergency recall ≥ 0.95 (target), precision reported with 95% confidence intervals</li>
                            <li>Emergency precision ≥ 99% (FPR < 1%) on held-out set; threshold fixed before testing</li>
                            <li>Extractor F1 ≥ 0.88 (target) on symptom extraction</li>
                            <li>P95 latency ≤ 2.0 s end-to-end on test rig (excluding external ASR)</li>
                        </ul>
                    </li>
                </ul>

                <h3>D7. Handover</h3>
                <ul>
                    <li>Deployment runbook (dev/stage), test datasets, config, and environment variables template</li>
                    <li>Admin quick-guide for adding/editing rules; developer notes for extending schema</li>
                </ul>

                <div class="highlight">
                    <strong>Out-of-scope (Phase A):</strong> Mobile apps, multi-language UX, EHR/PIMS integrations, insurance/payments, production SSO, SOC2 audit, full CSR console, full voice intake for emergencies (beyond POC + guardrails). These can be added in Phase B.
                </div>
            </div>

            <div class="section">
                <h2>3. Project Plan & Milestones</h2>
                <table class="milestone-table">
                    <thead>
                        <tr>
                            <th>Week</th>
                            <th>Dates</th>
                            <th>Milestone & Acceptance</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>W1</td>
                            <td>Aug 19–25</td>
                            <td>D1 PRD + compliance pack signed; ontology draft; pgvector dev DB online; baseline k-NN latency check. MVP runs Llama 3.1 8B (quantized) for extraction; Phase B option to migrate to Qwen2.5-14B.</td>
                        </tr>
                        <tr>
                            <td>W2</td>
                            <td>Aug 26–Sep 1</td>
                            <td>D2 schema finalized; synonym table; extractor baseline (prompt-only) with JSON validation & tests</td>
                        </tr>
                        <tr>
                            <td>W3</td>
                            <td>Sep 2–8</td>
                            <td>LoRA/parameter-efficient tuning (if data available); metrics ≥ baseline; rule engine scaffolding + first 30 rules</td>
                        </tr>
                        <tr>
                            <td>W4</td>
                            <td>Sep 9–15</td>
                            <td>Rule engine v0.1 (50–70 emergency rules) with audit trace; semantic fallback wired</td>
                        </tr>
                        <tr>
                            <td>W5</td>
                            <td>Sep 16–22</td>
                            <td>API + thin UI; end-to-end flow; preliminary KPI run on hold-out set</td>
                        </tr>
                        <tr>
                            <td>W6</td>
                            <td>Sep 23–30</td>
                            <td>Safety gate + KPI report; triage demo; handover package (runbook, guides, datasets)</td>
                        </tr>
                    </tbody>
                </table>
            </div>

            <div class="section">
                <h2>4. Client Responsibilities</h2>
                <ul>
                    <li>Provide de-identified labeled triage cases (goal 600) and SME time (≥ 4 hrs/week) for rule validation.</li>
                    <li>Provide infrastructure access (cloud project or on-prem) and designate a security contact.</li>
                    <li>Confirm legal/privacy posture for supplied data; designate decision-maker for acceptance sign-off.</li>
                </ul>
            </div>

            <div class="section">
                <h2>5. Assumptions</h2>
                <ul>
                    <li>Target species: dogs and cats.</li>
                    <li>Language: English only in Phase A.</li>
                    <li>Analytics and model artifacts may be stored in client cloud buckets.</li>
                    <li>Whisper/ASR used as POC only; emergency routing depends on text confirmation (guardrails in place).</li>
                    <li>All triage outputs carry a medical disclaimer and are for informational purposes with escalation instructions.</li>
                </ul>
            </div>

            <div class="section">
                <h2>6. Acceptance Criteria</h2>
                <ul>
                    <li><strong>Functional:</strong> MVP runs end-to-end via API + demo UI; rules fire deterministically; audit JSON present for every decision.</li>
                    <li><strong>Quality:</strong> 
                        <ul>
                            <li>Emergency recall ≥ 0.95, Emergency precision ≥ 99% (FPR < 1%) on held-out set (≥ 500 negatives, ≥ 150 positives)</li>
                            <li>Threshold selected on validation; reported with 95% confidence intervals</li>
                            <li>Extractor F1 ≥ 0.88 on symptom extraction</li>
                            <li>P95 latency ≤ 2.0 s</li>
                        </ul>
                    </li>
                    <li><strong>Documentation:</strong> Runbook + admin guide complete and usable by client staff.</li>
                </ul>
            </div>

            <div class="section">
                <h2>7. Timeline & Hours</h2>
                <ul>
                    <li>~120 hours over 6 calendar weeks (~20 hrs/week).</li>
                    <li>Work windows and cadences coordinated with Client PM; weekly status notes and live demo at milestone gates.</li>
                </ul>
            </div>

            <div class="section">
                <h2>8. Pricing & Payment</h2>
                <ul>
                    <li><strong>Rate:</strong> $120/hour (principal AI/ML + tech lead).</li>
                    <li><strong>Not-to-Exceed (NTE):</strong> $14,400 for Phase A labor (120 hrs).</li>
                    <li><strong>Infrastructure:</strong> billed at cost (GPU/compute, storage) with prior approval; initial estimate for Phase A is ≤ $2,000 (can be $0 if client allocates existing capacity).</li>
                    <li><strong>Invoicing:</strong> bi-weekly; Net 15. Overage hours require written change order.</li>
                </ul>
            </div>

            <div class="section">
                <h2>9. Change Control</h2>
                <p>Any scope/timeline/cost change requires a mutually signed change order specifying: change description, impact, and revised NTE if applicable.</p>
            </div>

            <div class="section">
                <h2>10. IP & Licensing</h2>
                <ul>
                    <li>Client owns deliverable code, rule base, configuration, and fine-tuned weights created under this SOW upon full payment.</li>
                    <li>Fine-tuned weights and rule-base are delivered to Client with a perpetual, transferable license for commercial use.</li>
                    <li>Contractor retains rights to pre-existing tools, generic libraries, and know-how (non-client-specific) licensed to Client under a perpetual, royalty-free license.</li>
                    <li>Third-party licenses (open-source or SaaS) remain under their original terms; SBOM provided.</li>
                </ul>
            </div>

            <div class="section">
                <h2>11. Confidentiality, Security, & Compliance</h2>
                <ul>
                    <li>Mutual NDA in force.</li>
                    <li>Data handled per security plan (encrypted at rest/in transit; least-privilege access; logs without PII).</li>
                    <li>Outputs include disclaimers; emergency recommendations include "seek immediate veterinary care / ER" language and escalation steps.</li>
                </ul>
                <div class="safety-box">
                    <h4>⚕️ Clinical Safety Policy</h4>
                    <p>This system provides triage guidance only and is not a substitute for a licensed veterinarian. It does not diagnose, prescribe, or provide medication dosing. If red-flag symptoms are present (e.g., cyanosis, active seizure, uncontrolled bleeding, male cat urinary obstruction, repeated vomiting without water retention, suspected GDV, bulging eye), the system will recommend immediate in-person veterinary care. When confidence is low or information is incomplete, the system asks targeted follow-up questions or advises an in-person visit. The assistant does not provide medication dosing or prescriptions.</p>
                </div>
            </div>

            <div class="section">
                <h2>12. Warranty & Limitation</h2>
                <ul>
                    <li>Workmanlike services warranty for 30 days post-delivery.</li>
                    <li>No clinical guarantees; model performance bounded by supplied data and acceptance thresholds.</li>
                    <li>No liability for indirect or consequential damages.</li>
                </ul>
            </div>

            <div class="section">
                <h2>13. Termination</h2>
                <p>Either party may terminate with 10 business days' notice. Client pays for work performed through effective termination date.</p>
            </div>

            <div class="section">
                <h2>14. Signatures</h2>
                <div class="signature-block">
                    <div class="signature-line">
                        <div class="signature-field">Client:</div>
                        <div class="signature-field">Title:</div>
                        <div class="signature-field">Date: ___/___/2025</div>
                    </div>
                    <div class="signature-line">
                        <div class="signature-field">Contractor:</div>
                        <div class="signature-field">Title:</div>
                        <div class="signature-field">Date: ___/___/2025</div>
                    </div>
                </div>
            </div>
        </section>

        <!-- PRD Document -->
        <section id="prd" class="document" role="tabpanel" aria-labelledby="tab-prd">
            <div class="doc-header">
                <h2>Product Requirements Document (PRD)</h2>
                <div class="doc-meta">
                    <div class="meta-item">
                        <span class="meta-label">Product</span>
                        <span class="meta-value">MyVet Direction - Hybrid AI Veterinary Triage (MVP)</span>
                    </div>
                    <div class="meta-item">
                        <span class="meta-label">Version</span>
                        <span class="meta-value">v1.0</span>
                    </div>
                    <div class="meta-item">
                        <span class="meta-label">Date</span>
                        <span class="meta-value">August 15, 2025</span>
                    </div>
                    <div class="meta-item">
                        <span class="meta-label">Owner</span>
                        <span class="meta-value">Product/Program (Client) & Contractor (Tech Lead)</span>
                    </div>
                </div>
            </div>

            <div class="section">
                <h2>1. Executive Summary</h2>
                <p>MyVet Direction enables clinical-grade veterinary triage by pairing LLM-based language understanding with a deterministic, explainable rule engine. Pet-owner language is converted into structured medical facts, evaluated against vetted emergency/urgent rules with semantic assistance, and returned with a clear priority and a full audit trace. MVP targets dogs & cats, English, and web demo interfaces.</p>
            </div>

            <div class="section">
                <h2>2. Goals & KPIs</h2>
                <table>
                    <thead>
                        <tr>
                            <th>Goal</th>
                            <th>KPI (MVP Target)</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>Detect emergencies reliably</td>
                            <td>Emergency recall ≥ 0.95 on blinded hold-out set (≥ 300–600 cases)</td>
                        </tr>
                        <tr>
                            <td>Detect emergencies conservatively</td>
                            <td>Emergency precision ≥ 99% (FPR < 1%)</td>
                        </tr>
                        <tr>
                            <td>Accurate symptom extraction</td>
                            <td>F1 ≥ 0.88 for key symptoms/qualifiers</td>
                        </tr>
                        <tr>
                            <td>Deterministic decisions</td>
                            <td>100% of triage results include audit JSON (rules fired, evidence)</td>
                        </tr>
                        <tr>
                            <td>Responsiveness</td>
                            <td>P95 latency ≤ 2.0 s (API request → response) excluding external ASR</td>
                        </tr>
                        <tr>
                            <td>Safety</td>
                            <td>Guardrails enforce human-in-loop when confidence < threshold or rule conflict</td>
                        </tr>
                    </tbody>
                </table>
            </div>

            <div class="section">
                <h2>3. Users & Personas</h2>
                <ul>
                    <li><strong>Pet Owner (Alex):</strong> initiates symptom description via web widget.</li>
                    <li><strong>CSR (Jordan):</strong> can use the same flow to structure calls.</li>
                    <li><strong>Vet Admin (Dr. Lee):</strong> reviews rules/audit traces; approves rule updates.</li>
                </ul>
            </div>

            <div class="section">
                <h2>4. Out-of-Scope (MVP)</h2>
                <ul>
                    <li>Native mobile apps; multi-language; clinic EHR/PIMS integrations; payments/insurance.</li>
                    <li>Production SSO; SOC2 certification.</li>
                    <li>Voice intake for emergencies beyond POC + safety filters.</li>
                </ul>
            </div>

            <div class="section">
                <h2>5. Functional Requirements</h2>

                <h3>FR-1 NLP → JSON Extractor</h3>
                <ul>
                    <li><strong>Input:</strong> free text (and, for POC, audio → text).</li>
                    <li><strong>Output:</strong> Pydantic-validated JSON symptoms with qualifiers (e.g., frequency, severity, color), plus context (species/age/repro if stated).</li>
                    <li><strong>Behavior:</strong> deterministic temperature, JSON repair on model drift, synonym normalization.</li>
                </ul>

                <h3>FR-2 Rule Evaluation Engine (Deterministic + Semantic Assist)</h3>
                <ul>
                    <li>Deterministic rule graph for Emergency & Urgent coverage of high-stakes cases (derived from your case list).</li>
                    <li>Semantic equivalence via embeddings (e.g., "tired" → lethargy) to prevent false negatives.</li>
                    <li>Priority resolver: selects highest-risk outcome when multiple rules match.</li>
                    <li>Output: priority, audit JSON (rules fired, evidence, conflicts), next best question when confidence < threshold.</li>
                </ul>

                <h3>FR-3 Safety & Escalation</h3>
                <ul>
                    <li>If extractor confidence < Θ or rules conflict, set priority to "Escalate for human review" and show ER guidance when symptoms are life-threatening.</li>
                    <li>No dosing/prescriptions. When red-flag keywords present or confidence < Θ, system escalates to in-person care or asks targeted follow-ups.</li>
                    <li>Always show instructive next steps and ER clinic search link placeholder (no live integration in MVP).</li>
                </ul>
                <div class="safety-box">
                    <h4>⚕️ Clinical Safety Policy</h4>
                    <p>This system provides triage guidance only and is not a substitute for a licensed veterinarian. It does not diagnose, prescribe, or provide medication dosing. If red-flag symptoms are present (e.g., cyanosis, active seizure, uncontrolled bleeding, male cat urinary obstruction, repeated vomiting without water retention, suspected GDV, bulging eye), the system will recommend immediate in-person veterinary care. When confidence is low or information is incomplete, the system asks targeted follow-up questions or advises an in-person visit.</p>
                </div>

                <h3>FR-4 API & Demo UI</h3>
                <ul>
                    <li><strong>Endpoints:</strong>
                        <ul>
                            <li>POST /extract → structured symptoms JSON</li>
                            <li>POST /triage → priority + audit JSON</li>
                            <li>POST /transcribe → transcript (POC only)</li>
                        </ul>
                    </li>
                    <li><strong>Demo UI:</strong> (Svelte + Vite + Tailwind): text box + optional audio upload, result card with priority badge, collapsible audit trace.</li>
                </ul>

                <h3>FR-5 Admin/Operations</h3>
                <ul>
                    <li>Rule files in version control with change logs.</li>
                    <li>Simple admin script/CLI to add/edit rules and regenerate embeddings index.</li>
                    <li>Metrics endpoint /metrics (Prometheus) for latency and error rates.</li>
                </ul>
            </div>

            <div class="section">
                <h2>6. Non-Functional Requirements</h2>
                <ul>
                    <li><strong>Performance:</strong> P95 ≤ 2.0 s; throughput ≥ 10 RPS on dev rig.</li>
                    <li><strong>Reliability:</strong> graceful degradation if semantic index unavailable (fallback to exact rules).</li>
                    <li><strong>Security/Privacy:</strong> HTTPS, token-auth, least-privilege; no PII stored by default.</li>
                    <li><strong>Explainability:</strong> audit JSON required for every decision.</li>
                    <li><strong>Accessibility:</strong> WCAG 2.2 AA basics in demo UI (labels, contrast, keyboard nav). Keyboard-navigable tabs, aria-* roles; prefers-reduced-motion honored.</li>
                    <li><strong>Observability:</strong> structured logs, tracing (OpenTelemetry), /healthz endpoint.</li>
                </ul>
            </div>

            <div class="section">
                <h2>7. Data Model (Pydantic Sketch)</h2>
                <div class="code-block">
class Priority(str, Enum):
    emergency = "Emergency"
    urgent = "Urgent"
    sick = "Sick"
    routine = "Routine"
    review = "Review"

class Symptom(BaseModel):
    name: str
    present: bool = True
    qualifiers: dict[str, str] | None = None

class Intake(BaseModel):
    species: Literal["dog","cat"] | None = None
    age_bucket: Literal["puppy/kitten","young","adult","senior"] | None = None
    reproductive_code: int | None = None
    free_text: str

class TriageResult(BaseModel):
    priority: Priority
    audit: list[str]                 # rules fired, reasoning
    follow_up: list[str] | None = None
    confidence: float | None = None

# Audit JSON Example:
{
  "priority": "Emergency",
  "why": ["ER-RESP-OPENMOUTH", "classifier_p=0.93>τ=0.90"],
  "rules_fired": [{"id":"ER-RESP-OPENMOUTH","explain":"Open-mouth breathing/cyanosis"}],
  "retrieval": [{"title":"Emergency signs (AAHA)","chunk_id":"aaha_12"}]
}
                </div>
            </div>

            <div class="section">
                <h2>8. Rule Engine Scope (MVP)</h2>
                <ul>
                    <li><strong>Emergency clusters:</strong> respiratory distress (open-mouth breathing, cyanosis), repeated vomiting not holding water, seizures now, severe bleeding, bloat/GDV suspicion, pyometra red flags, urinary obstruction (male cat), acute neuro deficits, obvious fracture, severe pain.</li>
                    <li><strong>Urgent clusters:</strong> persistent productive cough with colored sputum, eye discharge + swelling, suspected colitis, suspected endocrine crises (Addison's/Cushing's) indicators, fever + swollen joint.</li>
                    <li><strong>Sick/Monitor exemplars:</strong> intermittent vomiting with normal appetite, motion sickness only, hairball pattern in cats, diet change sensitivity.</li>
                    <li><strong>Each rule:</strong> id, criteria (normalized symptoms/qualifiers), priority, explanation, next_questions, references (internal).</li>
                </ul>
            </div>

            <div class="section">
                <h2>9. Architecture (MVP)</h2>
                <ul>
                    <li><strong>Backend:</strong> FastAPI (Python 3.12), Postgres + pgvector for embeddings, Redis for session state.</li>
                    <li><strong>Extractor:</strong> MVP runs Llama 3.1 8B (quantized) locally; Phase B upgrades to Qwen2.5-14B once data/traffic justify. Temperature 0; JSON-repair.</li>
                    <li><strong>Rule Engine:</strong> forward-chaining over normalized facts + cosine similarity fallback.</li>
                    <li><strong>DevOps:</strong> Docker, docker-compose (dev), GitHub Actions CI, Prometheus/Grafana for metrics.</li>
                    <li><strong>Front-end:</strong> Svelte + Vite + Tailwind; minimal demo only.</li>
                </ul>
            </div>

            <div class="section">
                <h2>10. API Contracts (selected)</h2>
                <h4>POST /extract</h4>
                <div class="code-block">
Request: 
{ 
    "intake": { 
        "free_text": "my dog is vomiting every hour", 
        "species": "dog" 
    } 
}

Response: 
{ 
    "symptoms": [
        {
            "name": "vomiting",
            "present": true,
            "qualifiers": {
                "frequency": "hourly"
            }
        }
    ], 
    "context": {
        "species": "dog"
    } 
}
                </div>

                <h4>POST /triage</h4>
                <div class="code-block">
Request: 
{ 
    "intake": {
        ... as above ...
    } 
}

Response: 
{ 
    "priority": "Emergency",
    "audit": [
        "R34: puppy+vomiting>3x → Emergency"
    ], 
    "follow_up": [
        "Is the abdomen distended?"
    ], 
    "confidence": 0.97 
}
                </div>
            </div>

            <div class="section">
                <h2>11. Testing & Acceptance</h2>
                <ul>
                    <li><strong>Datasets:</strong> client-supplied de-identified cases; targets as in KPIs.</li>
                    <li><strong>Unit tests:</strong> extractor JSON validity; rule firing determinism; semantic threshold behavior.</li>
                    <li><strong>Integration tests:</strong> end-to-end triage for golden paths across Emergency/Urgent/Sick.</li>
                    <li><strong>Performance tests:</strong> latency at P50/P95 with concurrency (k6 or Locust).</li>
                    <li><strong>Safety tests:</strong> ensure Emergency triggers when any life-threat symptom present.</li>
                </ul>
            </div>

            <div class="section">
                <h2>12. Risks & Mitigations</h2>
                <table>
                    <thead>
                        <tr>
                            <th>Risk</th>
                            <th>Mitigation</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>Insufficient labeled data</td>
                            <td>Active learning loop; SME labeling sprints; synthetic augmentation for non-critical symptoms</td>
                        </tr>
                        <tr>
                            <td>ASR hallucinations</td>
                            <td>Text-only fallback for emergency routing; cross-check with rules before classifying as Emergency</td>
                        </tr>
                        <tr>
                            <td>Domain drift (seasonal illnesses)</td>
                            <td>Monthly rule review cycle; embeddings refresh job</td>
                        </tr>
                        <tr>
                            <td>Over-reliance on LLM</td>
                            <td>Deterministic rules as primary; LLM only for extraction & synonyms</td>
                        </tr>
                    </tbody>
                </table>
            </div>

            <div class="section">
                <h2>13. Rollout & Handover (MVP)</h2>
                <ul>
                    <li>Demo in staging; UAT by SMEs; KPI report; handover session & materials.</li>
                    <li><strong>Phase B options (post-MVP):</strong> CSR console, multilingual, integrations, mobile, production SSO, SOC2, insurance APIs.</li>
                </ul>
            </div>

            <div class="section">
                <h2>14. Glossary</h2>
                <ul>
                    <li><strong>Audit JSON:</strong> Machine-readable explanation of which rules fired and why.</li>
                    <li><strong>Emergency recall:</strong> % of true emergencies correctly labeled as Emergency.</li>
                    <li><strong>Semantic fallback:</strong> Using embeddings to map colloquial terms to canonical symptom names.</li>
                </ul>
            </div>
        </section>

        <!-- Roadmap Document -->
        <section id="roadmap" class="document" role="tabpanel" aria-labelledby="tab-roadmap">
            <div class="doc-header">
                <h2>14-Day MVP Implementation Roadmap</h2>
                <div class="doc-meta">
                    <div class="meta-item">
                        <span class="meta-label">Duration</span>
                        <span class="meta-value">14 Days / 2 Weeks</span>
                    </div>
                    <div class="meta-item">
                        <span class="meta-label">Focus</span>
                        <span class="meta-value">Thin-slice MVP with audit trail</span>
                    </div>
                    <div class="meta-item">
                        <span class="meta-label">Target Species</span>
                        <span class="meta-value">Dogs & Cats</span>
                    </div>
                    <div class="meta-item">
                        <span class="meta-label">Language</span>
                        <span class="meta-value">English</span>
                    </div>
                </div>
            </div>

            <div class="section">
                <h2>MVP Goal (by Day 14)</h2>
                <p><strong>Thin-slice MVP that correctly flags top life-threatening presentations with an audit trail.</strong></p>
                
                <div class="acceptance-criteria">
                    <h3>Non-negotiable Acceptance Gates</h3>
                    <ul>
                        <li>Emergency recall ≥ 0.95 on a 40–60-case ER mini-set (manually validated)</li>
                        <li>Emergency precision ≥ 99% (FPR < 1%) on held-out set</li>
                        <li>Extractor F1 ≥ 0.85 on the same mini-set (symptom + key modifiers)</li>
                        <li>P95 latency ≤ 2.0 s (text-to-triage; ASR excluded)</li>
                        <li>Every decision returns audit JSON (rules fired, evidence, conflicts)</li>
                        <li>Three guided follow-up flows live: Vomiting, Straining to urinate (male cat), Respiratory distress</li>
                    </ul>
                </div>

                <h3>Scope (MVP)</h3>
                <ul>
                    <li><strong>Species:</strong> dog, cat; <strong>Language:</strong> English</li>
                    <li><strong>Emergency rules:</strong> ~35–50 covering these clusters:
                        <ul>
                            <li>Respiratory (open-mouth breathing, cyanosis, using abdomen)</li>
                            <li>GI (vomiting not holding water, puppy vomiting multiple times, coffee-grounds emesis, profuse bloody diarrhea)</li>
                            <li>Neuro (active seizures, acute wobbly/collapse)</li>
                            <li>Trauma/Bleeding/Ocular (uncontrolled bleeding, obvious fracture, bulging eye)</li>
                            <li>Urinary/Repro (male cat obstruction; unspayed female + late heat + lethargy = pyometra)</li>
                            <li>Toxin/high-risk ingestion (foreign body; chocolate = pointer only)</li>
                        </ul>
                    </li>
                    <li>Follow-up question generator for the three flows above</li>
                    <li>UI: minimal Svelte + Tailwind demo (text box, optional audio upload stub, triage card, collapsible audit)</li>
                </ul>
            </div>

            <div class="section">
                <h2>Technical Implementation Details</h2>
                
                <div class="implementation-box">
                    <h4>🛠️ Tech Stack & Setup</h4>
                    <ul>
                        <li><strong>LLM:</strong> Llama 3.1 8B (quantized) via Ollama for MVP; Phase B option: Qwen2.5-14B</li>
                        <li><strong>Embeddings:</strong> sentence-transformers/all-MiniLM-L6-v2 (384 dims)</li>
                        <li><strong>Vector DB:</strong> Postgres 15+ with pgvector extension</li>
                        <li><strong>Backend:</strong> FastAPI 0.104+, Pydantic 2.0+, Python 3.12</li>
                        <li><strong>Frontend:</strong> SvelteKit 2.0, Vite 5.0, TailwindCSS 3.4</li>
                        <li><strong>Infra:</strong> Docker Compose for local, Railway/Render for staging</li>
                    </ul>
                </div>

                <div class="implementation-box">
                    <h4>📊 Data Structures</h4>
                    <div class="code-block">
# Symptom Bundle Example
{
  "vomiting": {
    "present": true,
    "modifiers": { 
      "frequency": "hourly|several_per_hour|multiple_times", 
      "content": "bile|coffee_grounds|foam", 
      "duration_h": 6 
    }
  }
}

# Rule DSL Example
{
  "id": "ER-GDV-001",
  "priority": "Emergency",
  "when_all": [
    ["species","in",["dog"]],
    ["symptom.vomiting.present","=", true],
    ["symptom.vomiting.modifiers.frequency","in",["several_per_hour","multiple_times"]]
  ],
  "explain": ["Repeated vomiting suggests GDV risk"],
  "next_questions": ["Is the abdomen distended?"]
}
                    </div>
                </div>
            </div>

            <div class="section">
                <h2>Two-Week Plan (Day-by-Day)</h2>
                
                <div class="week-separator">
                    <span class="week-label">WEEK 1 — Foundation + End-to-End Smoke</span>
                </div>

                <div class="day-card">
                    <div class="day-header">
                        <span class="day-title">Day 1 (Monday) – Kickoff & Guardrails</span>
                        <span class="day-badge">Setup</span>
                    </div>
                    <ul>
                        <li>Confirm MVP acceptance gates above; freeze thin scope</li>
                        <li>Create case mini-set (40–60): select from your Case 1–170 list to cover ER clusters; mark gold labels</li>
                        <li>Set up Llama 3.1 8B (quantized) for MVP extraction</li>
                    </ul>
                    <div class="how-to-box">
                        <h4>🔧 HOW TO IMPLEMENT:</h4>
                        <ol>
                            <li>Set up GitHub repo with this structure:
                                <div class="tech-detail">
myvet-direction/
├── backend/
│   ├── agents/          # LLM extractors
│   ├── engine/          # Rule engine
│   ├── api/            # FastAPI endpoints
│   └── models/         # Pydantic schemas
├── frontend/           # Svelte app
├── rules/             # JSON rule files
├── data/              # Test cases, synonyms
└── docker-compose.yml
                                </div>
                            </li>
                            <li>Install Ollama locally: <code>curl -fsSL https://ollama.ai/install.sh | sh</code></li>
                            <li>Pull Llama 3.1: <code>ollama pull llama3.1:8b-instruct-q5_K_M</code></li>
                            <li>Set up Postgres with pgvector:
                                <div class="tech-detail">
docker run -d \
  --name pgvector \
  -e POSTGRES_PASSWORD=vectordb123 \
  -p 5432:5432 \
  ankane/pgvector:latest
                                </div>
                            </li>
                        </ol>
                    </div>
                    <div class="deliverables-list">
                        <strong>Deliverables:</strong> Repo structure, dev environment running, mini-set CSV with labels
                    </div>
                </div>

                <div class="day-card">
                    <div class="day-header">
                        <span class="day-title">Day 2 (Tuesday) – Schema & Ontology</span>
                        <span class="day-badge">Schema</span>
                    </div>
                    <ul>
                        <li>Finalize Pydantic schemas: Intake, Symptom, TriageResult</li>
                        <li>Lock bundle+modifier catalog (vomiting, diarrhea, respiratory_distress, bleeding, neuro, urinary, repro)</li>
                        <li>Build synonym map (e.g., "tired"→lethargic; "wretching"→vomiting_attempt)</li>
                    </ul>
                    <div class="how-to-box">
                        <h4>🔧 HOW TO IMPLEMENT:</h4>
                        <div class="tech-detail">
# backend/models/schema.py
from pydantic import BaseModel
from enum import Enum
from typing import Literal, Optional

class Priority(str, Enum):
    emergency = "Emergency"
    urgent = "Urgent"
    sick = "Sick"
    
class Symptom(BaseModel):
    name: str
    present: bool = True
    qualifiers: dict[str, str] | None = None
    
# data/synonyms.json
{
  "vomiting": ["throwing up", "puking", "retching", "heaving"],
  "lethargic": ["tired", "sleepy", "no energy", "weak"]
}
                        </div>
                    </div>
                    <div class="deliverables-list">
                        <strong>Deliverables:</strong> /models/schema.py, /data/synonyms.json, /data/bundles.yaml
                    </div>
                </div>

                <div class="day-card">
                    <div class="day-header">
                        <span class="day-title">Day 3 (Wednesday) – Extractor v0</span>
                        <span class="day-badge">NLP</span>
                    </div>
                    <ul>
                        <li>Implement ExtractorAgent: prompt template + JSON-repair, temperature=0</li>
                        <li>Unit tests: JSON validity, key bundle coverage</li>
                    </ul>
                    <div class="how-to-box">
                        <h4>🔧 HOW TO IMPLEMENT:</h4>
                        <div class="tech-detail">
# backend/agents/extractor.py
import ollama
from pydantic import ValidationError
import json

class ExtractorAgent:
    def __init__(self):
        self.client = ollama.Client()
        self.prompt_template = """
Extract symptoms from this pet owner description.
Return ONLY valid JSON matching this schema:
{
  "symptoms": [
    {
      "name": "symptom_name",
      "present": true/false,
      "qualifiers": {"key": "value"}
    }
  ],
  "context": {
    "species": "dog/cat",
    "age_bucket": "puppy/adult/senior"
  }
}

Text: {input_text}
JSON:"""
        
    async def extract(self, text: str) -> dict:
        response = self.client.generate(
            model='llama3.1:8b-instruct-q5_K_M',
            prompt=self.prompt_template.format(input_text=text),
            options={'temperature': 0}
        )
        # Add JSON repair logic here
        return self._repair_json(response['response'])
                        </div>
                    </div>
                    <div class="deliverables-list">
                        <strong>Deliverables:</strong> /agents/extractor.py with tests passing
                    </div>
                </div>

                <div class="day-card">
                    <div class="day-header">
                        <span class="day-title">Day 4 (Thursday) – Rule Engine skeleton</span>
                        <span class="day-badge">Engine</span>
                    </div>
                    <ul>
                        <li>Implement minimal deterministic engine supporting: when_all/when_any, tri-state (0/1/2), numeric and set operators, and audit trail (rules fired)</li>
                        <li>Load rules from JSON</li>
                    </ul>
                    <div class="how-to-box">
                        <h4>🔧 HOW TO IMPLEMENT:</h4>
                        <div class="tech-detail">
# backend/engine/rule_engine.py
class RuleEngine:
    def __init__(self, rules_path: str):
        self.rules = self._load_rules(rules_path)
        self.audit_trail = []
        
    def evaluate(self, facts: dict) -> TriageResult:
        fired_rules = []
        for rule in self.rules:
            if self._check_conditions(rule['when_all'], facts):
                fired_rules.append(rule)
                self.audit_trail.append({
                    'rule_id': rule['id'],
                    'evidence': facts,
                    'explanation': rule['explain']
                })
        
        priority = self._resolve_priority(fired_rules)
        return TriageResult(
            priority=priority,
            audit=self.audit_trail,
            follow_up=self._get_follow_ups(fired_rules)
        )
                        </div>
                    </div>
                    <div class="deliverables-list">
                        <strong>Deliverables:</strong> /engine/rule_engine.py, /rules/er_v0.json, audit events working
                    </div>
                </div>

                <div class="day-card">
                    <div class="day-header">
                        <span class="day-title">Day 5 (Friday) – ER Rules v0 (≈25)</span>
                        <span class="day-badge">Rules</span>
                    </div>
                    <ul>
                        <li>Encode first 25 ER rules pulled from your list (respiratory, GI, neuro, trauma/bleeding, urinary/repro)</li>
                        <li>Smoke test: 10 gold cases pass end-to-end (text → extract → triage → audit)</li>
                    </ul>
                    <div class="how-to-box">
                        <h4>🔧 HOW TO IMPLEMENT:</h4>
                        <p>Create rules/er_v0.json with patterns like:</p>
                        <div class="tech-detail">
[
  {
    "id": "ER-RESP-001",
    "priority": "Emergency",
    "when_all": [
      ["symptom.respiratory_distress.present", "=", true],
      ["symptom.respiratory_distress.modifiers.pattern", "in", ["open_mouth", "abdominal"]]
    ],
    "explain": ["Open-mouth breathing indicates severe respiratory distress"],
    "next_questions": ["Are the gums blue or pale?"]
  },
  {
    "id": "ER-GI-002",
    "priority": "Emergency",
    "when_all": [
      ["species", "=", "dog"],
      ["symptom.vomiting.present", "=", true],
      ["symptom.vomiting.modifiers.frequency", "in", ["hourly", "continuous"]],
      ["symptom.vomiting.modifiers.content", "in", ["coffee_grounds", "blood"]]
    ],
    "explain": ["Blood in vomit requires immediate attention"],
    "next_questions": ["How much blood do you see?"]
  }
]
                        </div>
                    </div>
                    <div class="deliverables-list">
                        <strong>Deliverables:</strong> /rules/er_v0.json with ≥25 rules; 10 test cases passing
                    </div>
                </div>

                <div class="day-card">
                    <div class="day-header">
                        <span class="day-title">Day 6 (Saturday) – Semantic assist POC</span>
                        <span class="day-badge">Semantic</span>
                    </div>
                    <ul>
                        <li>Add embedding normalizer: map owner words to canonical bundle keys before rule evaluation (e.g., cosine on synonyms list; threshold default 0.78)</li>
                        <li>Back-fill synonym tests (e.g., "heaving," "retching," "tarry stool")</li>
                    </ul>
                    <div class="how-to-box">
                        <h4>🔧 HOW TO IMPLEMENT:</h4>
                        <div class="tech-detail">
# backend/engine/semantic.py
from sentence_transformers import SentenceTransformer
import numpy as np

class SemanticNormalizer:
    def __init__(self):
        self.model = SentenceTransformer('all-MiniLM-L6-v2')
        self.symptom_embeddings = self._precompute_embeddings()
        
    def normalize(self, text: str, threshold: float = 0.78) -> str:
        text_embedding = self.model.encode(text)
        
        # Find closest canonical symptom
        similarities = {}
        for symptom, embedding in self.symptom_embeddings.items():
            similarity = np.dot(text_embedding, embedding) / (
                np.linalg.norm(text_embedding) * np.linalg.norm(embedding)
            )
            if similarity > threshold:
                similarities[symptom] = similarity
                
        return max(similarities, key=similarities.get) if similarities else text
                        </div>
                    </div>
                    <div class="deliverables-list">
                        <strong>Deliverables:</strong> /engine/semantic.py, synonym mapping tests passing
                    </div>
                </div>

                <div class="day-card">
                    <div class="day-header">
                        <span class="day-title">Day 7 (Sunday) – Thin UI + API</span>
                        <span class="day-badge">UI/API</span>
                    </div>
                    <ul>
                        <li>FastAPI endpoints: /extract, /triage</li>
                        <li>Svelte demo: input text → triage card → collapsible audit</li>
                    </ul>
                    <div class="how-to-box">
                        <h4>🔧 HOW TO IMPLEMENT:</h4>
                        <div class="tech-detail">
# backend/api/main.py
from fastapi import FastAPI
from fastapi.middleware.cors import CORSMiddleware

app = FastAPI()
app.add_middleware(CORSMiddleware, allow_origins=["*"])

@app.post("/extract")
async def extract_symptoms(intake: Intake):
    symptoms = await extractor.extract(intake.free_text)
    return {"symptoms": symptoms}

@app.post("/triage")
async def triage(intake: Intake):
    symptoms = await extractor.extract(intake.free_text)
    result = engine.evaluate(symptoms)
    return result

# Frontend: npm create vite@latest frontend -- --template svelte
# Then add TailwindCSS and create simple form
                        </div>
                    </div>
                    <div class="deliverables-list">
                        <strong>Deliverables:</strong> API running at localhost:8000, UI at localhost:5173
                    </div>
                    <div class="milestone-marker">
                        ✓ Milestone M1: End-to-end clickable demo, 15 gold cases pass, P95 latency snapshot
                    </div>
                </div>

                <div class="week-separator">
                    <span class="week-label">WEEK 2 — Coverage, Follow-ups, Metrics, MVP Gate</span>
                </div>

                <div class="day-card">
                    <div class="day-header">
                        <span class="day-title">Day 8 (Monday) – ER Rule Coverage (→ ~45–50)</span>
                        <span class="day-badge">Rules</span>
                    </div>
                    <ul>
                        <li>Expand to ~50 ER rules (add pyometra red flags, male-cat obstruction, coffee-grounds emesis, profuse nasal/oral bleeding, bulging eye, seizure-now)</li>
                        <li>Add priority resolver (if multiple rules fire, choose highest risk with deterministic tiebreak)</li>
                    </ul>
                    <div class="how-to-box">
                        <h4>🔧 HOW TO IMPLEMENT:</h4>
                        <p>Add critical patterns to rules/er_v1.json:</p>
                        <div class="tech-detail">
{
  "id": "ER-URO-001",
  "priority": "Emergency",
  "when_all": [
    ["species", "=", "cat"],
    ["sex", "=", "male"],
    ["symptom.straining_urinate.present", "=", true],
    ["symptom.urination.modifiers.output", "in", ["drops", "none", "minimal"]]
  ],
  "explain": ["Male cat urinary blockage is life-threatening"],
  "next_questions": ["Is the cat crying or vocalizing in pain?"]
}
                        </div>
                    </div>
                    <div class="deliverables-list">
                        <strong>Deliverables:</strong> /rules/er_v1.json (~50 rules), priority resolver tested
                    </div>
                </div>

                <div class="day-card">
                    <div class="day-header">
                        <span class="day-title">Day 9 (Tuesday) – Follow-up Question Generator v0</span>
                        <span class="day-badge">Follow-up</span>
                    </div>
                    <ul>
                        <li>Implement FollowUpAgent with question_context for 3 flows: Vomiting, Male-cat urination, Respiratory distress</li>
                        <li>Hook into engine: when rule confidence < Θ or additional slot needed, return next_questions</li>
                    </ul>
                    <div class="how-to-box">
                        <h4>🔧 HOW TO IMPLEMENT:</h4>
                        <div class="tech-detail">
# backend/agents/follow_up.py
class FollowUpAgent:
    def __init__(self):
        self.question_flows = {
            "vomiting": [
                "How many times in the last hour?",
                "Can they keep water down?",
                "Is the abdomen distended or tight?",
                "What color is the vomit?"
            ],
            "urinary_male_cat": [
                "How long has this been happening?",
                "Any vocalizing or crying?",
                "Has he produced any urine at all?",
                "Is he licking his genital area?"
            ],
            "respiratory": [
                "Are the gums blue, pale, or pink?",
                "Is there any coughing?",
                "How long has this been happening?",
                "Any recent trauma or injury?"
            ]
        }
        
    def get_next_question(self, symptoms: dict, answered: list) -> str:
        # Logic to determine which flow and next unanswered question
        pass
                        </div>
                    </div>
                    <div class="deliverables-list">
                        <strong>Deliverables:</strong> /agents/follow_up_question_generator.py, integration tests
                    </div>
                </div>

                <div class="day-card">
                    <div class="day-header">
                        <span class="day-title">Day 10 (Wednesday) – Metrics & Safety</span>
                        <span class="day-badge">Metrics</span>
                    </div>
                    <ul>
                        <li>Add metrics: latency (P50/P95), extraction F1 on mini-set, ER recall/precision, rule-fire counts</li>
                        <li>Safety gate: force Emergency when any "hard stop" symptom present (cyanosis, uncontrolled bleeding, seizure-now), even if extractor confidence is low</li>
                    </ul>
                    <div class="how-to-box">
                        <h4>🔧 HOW TO IMPLEMENT:</h4>
                        <div class="tech-detail">
# backend/engine/safety.py
class SafetyGate:
    HARD_STOP_SYMPTOMS = [
        "cyanosis", "blue_gums", "unconscious", "not_breathing",
        "severe_bleeding", "seizure_active", "collapsed"
    ]
    
    def check(self, symptoms: dict) -> tuple[bool, str]:
        for symptom in symptoms:
            if symptom['name'] in self.HARD_STOP_SYMPTOMS:
                return True, f"EMERGENCY: {symptom['name']} detected"
        return False, None

# backend/metrics/evaluator.py
from sklearn.metrics import f1_score, recall_score, precision_score
import time

class MetricsEvaluator:
    def evaluate_mini_set(self, test_cases: list):
        results = {
            'latencies': [],
            'predictions': [],
            'ground_truth': []
        }
        
        for case in test_cases:
            start = time.time()
            prediction = await self.triage(case['text'])
            results['latencies'].append(time.time() - start)
            results['predictions'].append(prediction.priority)
            results['ground_truth'].append(case['label'])
            
        return {
            'p95_latency': np.percentile(results['latencies'], 95),
            'recall': recall_score(results['ground_truth'], results['predictions']),
            'precision': precision_score(results['ground_truth'], results['predictions']),
            'f1': f1_score(results['ground_truth'], results['predictions'])
        }
                        </div>
                    </div>
                    <div class="deliverables-list">
                        <strong>Deliverables:</strong> /metrics/*, safety.py, threshold config
                    </div>
                </div>

                <div class="day-card">
                    <div class="day-header">
                        <span class="day-title">Day 11 (Thursday) – Calibration sprint</span>
                        <span class="day-badge">Tuning</span>
                    </div>
                    <ul>
                        <li>Run mini-set; perform error analysis: misses → add synonyms/modifiers or refine prompts; false positives → tighten rules or thresholds</li>
                        <li>Tune semantic threshold per bundle (e.g., vomiting 0.80, respiratory 0.76)</li>
                        <li>Ensure Emergency precision ≥ 99% (FPR < 1%)</li>
                    </ul>
                    <div class="how-to-box">
                        <h4>🔧 HOW TO IMPLEMENT:</h4>
                        <ol>
                            <li>Run evaluation script on all 60 test cases</li>
                            <li>Generate confusion matrix</li>
                            <li>For each false negative:
                                <ul>
                                    <li>Check if synonym missing → add to synonyms.json</li>
                                    <li>Check if rule missing → add new rule</li>
                                    <li>Check if threshold too high → adjust</li>
                                </ul>
                            </li>
                            <li>For each false positive:
                                <ul>
                                    <li>Tighten rule conditions</li>
                                    <li>Add negative qualifiers</li>
                                </ul>
                            </li>
                            <li>Re-run until targets met (especially FPR < 1%)</li>
                        </ol>
                    </div>
                    <div class="deliverables-list">
                        <strong>Deliverables:</strong> Calibration report v1; updated rules & synonyms
                    </div>
                </div>

                <div class="day-card">
                    <div class="day-header">
                        <span class="day-title">Day 12 (Friday) – ASR stub + UX polish</span>
                        <span class="day-badge">Polish</span>
                    </div>
                    <ul>
                        <li>Whisper (POC) endpoint /transcribe with text-only gate (no ER routing without text confirmation)</li>
                        <li>UI polish: badges for Emergency/Urgent/Sick, expandable "Why we think this" audit</li>
                    </ul>
                    <div class="how-to-box">
                        <h4>🔧 HOW TO IMPLEMENT:</h4>
                        <div class="tech-detail">
# backend/api/transcribe.py
import whisper

model = whisper.load_model("base")

@app.post("/transcribe")
async def transcribe_audio(audio_file: UploadFile):
    # Save temp file
    result = model.transcribe(temp_path)
    
    # SAFETY: Require text confirmation for emergencies
    return {
        "transcript": result["text"],
        "requires_confirmation": True,
        "message": "Please confirm the text before triage"
    }

# Frontend: Add Tailwind badge classes
<div class="badge {priority === 'Emergency' ? 'badge-error' : 'badge-warning'}">
  {priority}
</div>
                        </div>
                    </div>
                    <div class="deliverables-list">
                        <strong>Deliverables:</strong> working ASR stub, polished UI with badges
                    </div>
                </div>

                <div class="day-card">
                    <div class="day-header">
                        <span class="day-title">Day 13 (Saturday) – Pre-MVP Validation</span>
                        <span class="day-badge">Validation</span>
                    </div>
                    <ul>
                        <li>Blind run on all 40–60 gold cases</li>
                        <li>Targets to hit: ER recall ≥ 0.95, ER precision ≥ 0.99 (FPR < 1%), Extractor F1 ≥ 0.85, P95 ≤ 2.0 s</li>
                        <li>If short: iterate once more on synonyms/rules</li>
                    </ul>
                    <div class="how-to-box">
                        <h4>🔧 HOW TO IMPLEMENT:</h4>
                        <div class="tech-detail">
# Run full validation
python scripts/validate.py --test-set data/gold_cases.csv --output results.csv

# Expected output format:
Case ID | Input Text | Predicted | Actual | Latency | Audit | Pass/Fail
1       | "dog vom..." | Emergency | Emergency | 1.2s | [rules] | ✓
2       | "cat str..." | Emergency | Emergency | 0.9s | [rules] | ✓

# Calculate final metrics
Emergency Recall: 58/60 = 0.967 ✓
Emergency Precision: 58/58 = 1.00 ✓ (FPR: 0%)
F1 Score: 0.89 ✓
P95 Latency: 1.8s ✓
                        </div>
                    </div>
                    <div class="deliverables-list">
                        <strong>Deliverables:</strong> Validation report + CSV of predictions & audits
                    </div>
                </div>

                <div class="day-card">
                    <div class="day-header">
                        <span class="day-title">Day 14 (Sunday) – MVP Freeze & Demo Pack</span>
                        <span class="day-badge">Release</span>
                    </div>
                    <ul>
                        <li>Freeze versions, tag mvp-0.1.0</li>
                        <li>Package demo script (three canonical scenarios), admin "how-to edit a rule", and runbook</li>
                    </ul>
                    <div class="how-to-box">
                        <h4>🔧 HOW TO IMPLEMENT:</h4>
                        <div class="tech-detail">
# Tag release
git tag -a mvp-0.1.0 -m "MVP Release: 14-day sprint complete"
git push origin mvp-0.1.0

# Create docker-compose.prod.yml
version: '3.8'
services:
  backend:
    build: ./backend
    environment:
      - MODEL_PATH=/models/llama3.1:8b-instruct-q5_K_M
      - RULES_PATH=/app/rules/er_v1.json
    ports:
      - "8000:8000"
  
  frontend:
    build: ./frontend
    ports:
      - "3000:3000"
  
  postgres:
    image: ankane/pgvector
    volumes:
      - pgdata:/var/lib/postgresql/data

# Package deployment script
#!/bin/bash
docker-compose -f docker-compose.prod.yml up -d
docker-compose exec backend python scripts/load_embeddings.py
echo "MyVet Direction MVP running at http://localhost:3000"
                        </div>
                    </div>
                    <div class="deliverables-list">
                        <strong>Deliverables:</strong> Tagged release, demo package, deployment script
                    </div>
                    <div class="milestone-marker">
                        ✓ Milestone M2 (MVP): All acceptance gates met; demo ready
                    </div>
                </div>
            </div>

            <!-- Rest of roadmap sections remain the same... -->
        </section>
    </main>

    <div class="action-buttons">
        <button class="action-button secondary" onclick="exportPDF()">
            📄 Export PDF
        </button>
        <button class="action-button" onclick="window.print()">
            🖨️ Print
        </button>
    </div>

    <script>
        const TAB_IDS = ['sow','prd','roadmap'];

        function applyActive(tabName, btn) {
            document.querySelectorAll('.document').forEach(p => {
                p.classList.remove('active');
                p.setAttribute('aria-hidden', 'true');
            });
            document.querySelectorAll('.nav-tab').forEach(t => {
                t.classList.remove('active');
                t.setAttribute('aria-selected','false');
            });
            
            const activeDoc = document.getElementById(tabName);
            if (activeDoc) {
                activeDoc.classList.add('active');
                activeDoc.setAttribute('aria-hidden', 'false');
            }
            
            if (btn) {
                btn.classList.add('active');
                btn.setAttribute('aria-selected','true');
                btn.focus();
            } else {
                const autoBtn = document.querySelector(`#tab-${tabName}`);
                if (autoBtn) {
                    autoBtn.classList.add('active');
                    autoBtn.setAttribute('aria-selected','true');
                }
            }
        }

        function switchTab(tabName, element) {
            if (!TAB_IDS.includes(tabName)) tabName = 'sow';
            // activate
            applyActive(tabName, element);
            // update URL hash without jumping
            history.pushState({tab: tabName}, '', `#${tabName}`);
            // save preference
            localStorage.setItem('mvd.activeTab', tabName);
            // Scroll to top but avoid abrupt motion for reduced-motion users
            if (!window.matchMedia('(prefers-reduced-motion: reduce)').matches) {
                window.scrollTo({ top: 0, behavior: 'smooth' });
            } else {
                window.scrollTo(0,0);
            }
        }

        // Handle direct links, reloads, and back/forward
        window.addEventListener('DOMContentLoaded', () => {
            const hash = location.hash.replace('#','');
            const saved = localStorage.getItem('mvd.activeTab');
            const tab = TAB_IDS.includes(hash) ? hash : (TAB_IDS.includes(saved) ? saved : 'sow');
            applyActive(tab);
        });

        window.addEventListener('popstate', (e) => {
            const tab = (e.state && e.state.tab) ? e.state.tab : (location.hash||'#sow').replace('#','');
            applyActive(TAB_IDS.includes(tab) ? tab : 'sow');
        });

        // Export to PDF function
        function exportPDF() {
            // Store current state
            const currentTab = document.querySelector('.document.active').id;
            
            // Show all documents for PDF export
            document.querySelectorAll('.document').forEach(doc => {
                doc.style.display = 'block';
            });
            
            // Trigger print dialog
            window.print();
            
            // Restore original state after print
            setTimeout(() => {
                document.querySelectorAll('.document').forEach(doc => {
                    doc.style.display = '';
                });
                applyActive(currentTab);
            }, 100);
        }
    </script>
</body>
</html>